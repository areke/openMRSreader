<!DOCTYPE html> 
<html> 
<head> 
    <title>My Page</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="stylesheet" href="css/jquery.mobile-1.2.0.min.css" />
    <link rel="stylesheet" href="css/index.css" />
    <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript">$(document).bind("mobileinit", function () {  $.mobile.defaultPageTransition = "none"; });</script>
    <script type="text/javascript" src="js/jquery.mobile-1.2.0.min.js"></script>
    <script src="cordova-2.2.0.js"></script>
    <script src ="childbrowser.js"></script>
    <script src ="share.js"></script>
</head> 
<body> 

<div data-role="page" id = "viewPage">
    <div data-role="header" data-theme="b" data-tap-toggle="false" height:"50px;">
        <h1 style = "font-size: 23px; white-space: normal;">OpenMRS</h1>
    </div>

    <div data-role="content">
        <ul id = "list2" data-role="listview" data-icon="arrow-r" data-inset="true" data-filter="false" data-theme="d" style="white-space: normal">
            <li class="contentLink2" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="1">OpenMRS Implementers Google Group</a></li>
            <li class="contentLink2" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="2">Bamboo build results feed for all builds</a></li>
            <li class="contentLink2" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="3">Bamboo failed build results feed for all builds</a></li>
            <li class="contentLink2" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="4">OpenMRS Screencasts/Videos</a></li>
            <li class="contentLink2" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="5">OpenMRS Developers</a></li>
            <li class="contentLink2" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="6">OpenMRS Announcements</a></li>
            <li class="contentLink2" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="7">OpenMRS Subversion Commits</a></li>
            <li class="contentLink2" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="8">FishEye</a></li>
            <li class="contentLink2" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="9">Crucible</a></li>
        </ul> 
    </div>
</div>
<div data-role="page" id = "mainPage">

    <div data-role="header" data-theme="b" data-tap-toggle="false" height:"50px;">
        <h1 style = "font-size: 23px; white-space: normal;">OpenMRS</h1>
    </div>

    <div data-role="content">   
        <ul id = "list" data-role="listview" data-icon="arrow-r" data-inset="true" data-filter="false" data-theme="d" style="white-space: normal">

        </ul> 
    </div>
    <div data-role="footer" data-theme="b" data-position="fixed" style = "text-align:center; height: 50px;">
        <div data-role="navbar">
            <ul id = "navigation">
                <li><a href="#viewPage" data-rel="back" id = "back" data-transition="slide">Back</a></li>
            </ul>
        </div>
    </div>
</div>

<div data-role="page" id="DisplayPage">
    <div data-role="header" data-theme="b" style = "white-space: normal;">
        <h1 style = "font-size: 23px; white-space: normal; margin-left: auto; margin-right: auto; width: 300px;" id = "titleText"></h1>
    </div>

    <div data-role="content" id = "article" style = "overflow: auto;">
    </div>


    <div data-role="footer" data-theme="b" data-position="fixed" style = "text-align:center; height: 50px;">
        <div data-role="navbar">
            <ul id = "navigation">
                <li><a href="#mainPage" data-rel="back" id = "back" data-transition="slide">Back</a></li>
                <li><a href="#share" id = "share" data-transition="slide">Share</a></li>
            </ul>
        </div>
    </div>
</div>



<script type = "text/javascript">
    $(document).ready(function() {
        document.addEventListener("deviceready", onDeviceReady, false);
        var xml = ['https://groups.google.com/a/openmrs.org/group/implementers/feed/rss_v2_0_topics.xml','https://ci.openmrs.org/rss/createAllBuildsRssFeed.action?feedType=rssAll','https://ci.openmrs.org/rss/createAllBuildsRssFeed.action?feedType=rssFailed','http://gdata.youtube.com/feeds/base/users/OpenMRS/uploads?alt=rss&v=2&orderby=published&client=ytapi-youtube-profile','https://groups.google.com/a/openmrs.org/group/dev/feed/rss_v2_0_topics.xml','https://groups.google.com/a/openmrs.org/group/announce/feed/rss_v2_0_topics.xml','https://groups.google.com/a/openmrs.org/group/svn/feed/rss_v2_0_topics.xml','https://source.openmrs.org/?view=fe&RSS=true','https://source.openmrs.org/?view=cru&RSS=true'];
        $(".contentLink2").bind("click", function() { //Capture link click
            selected = $(this).data("entryid");
            if (typeof selected !== "undefined") { //Check if everything is okay
                feed = xml[(selected-1)];
                window.location = "#mainPage"; //View the content
            }
        });
        $("#mainPage").bind("pagebeforeshow", function(prepage) {
            $("#list").empty();
            var selectedEntry = "";
            var xml1 = ['https://ci.openmrs.org/rss/createAllBuildsRssFeed.action?feedType=rssAll','https://ci.openmrs.org/rss/createAllBuildsRssFeed.action?feedType=rssFailed','http://gdata.youtube.com/feeds/base/users/OpenMRS/uploads?alt=rss&v=2&orderby=published&client=ytapi-youtube-profile'];
            var xml2 = ['https://groups.google.com/a/openmrs.org/group/dev/feed/rss_v2_0_topics.xml','https://groups.google.com/a/openmrs.org/group/announce/feed/rss_v2_0_topics.xml','https://groups.google.com/a/openmrs.org/group/svn/feed/rss_v2_0_topics.xml','https://source.openmrs.org/?view=fe&RSS=true','https://source.openmrs.org/?view=cru&RSS=true'];
            xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET",feed,false); 
            xmlhttp.send();
            xmlDoc = xmlhttp.responseXML; //Get the xml
            var list = "";
            if (xml1.indexOf(feed) != -1) {
                items = xmlDoc.getElementsByTagName("item"); //Get each item individually
                for (i = 0; i < items.length; i++) { 
                        var title = (items[i].getElementsByTagName("title")[0].childNodes[0].nodeValue);
                        var date = (items[i].getElementsByTagName("pubDate")[0].childNodes[0].nodeValue).split(" +0000")[0];
                        var description = items[i].getElementsByTagName("description")[0].childNodes[0].nodeValue;
                        list += '<li class="contentLink" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="'+i+'">' + title + '<br><br><p>' + date + '</p><br></a></li>'; //Create the list
                    }
            }
            else if (xml2.indexOf(feed) != -1) {
                items = xmlDoc.getElementsByTagName("item"); //Get each item individually
                for (i = 0; i < items.length; i++) { 
                        var title = (items[i].getElementsByTagName("title")[0].childNodes[0].nodeValue);
                        var date = (items[i].getElementsByTagName("pubDate")[0].childNodes[0].nodeValue).split(" +0000")[0];
                        var description = items[i].getElementsByTagName("description")[0].childNodes[0].nodeValue;
                        list += '<li class="contentLink" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="'+i+'">' + title + '<br><br><p>' + date + '</p><br></a></li>'; //Create the list
                    }  
            }
            else if (xml.indexOf(feed) == 0) {
                items = xmlDoc.getElementsByTagName("item"); //Get each item individually
                for (i = 0; i < items.length; i++) { 
                        if (i == 1) {
                        var title = "No Title";
                        }
                        else {
                        var title = (items[i].getElementsByTagName("title")[0].childNodes[0].nodeValue);
                        }
                        var date = (items[i].getElementsByTagName("pubDate")[0].childNodes[0].nodeValue).split(" +0000")[0];
                        var description = items[i].getElementsByTagName("description")[0].childNodes[0].nodeValue;
                        list += '<li class="contentLink" style = "height: 100px"; text-align:center;><a href="#" data-transition="slide" class="contentLink" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="'+i+'">' + title + '<br><br><p>' + date + '</p><br></a></li>'; //Create the list
                    }  
            }
            $("#list").append(list);
            $("#list").listview("refresh");
            $(".contentLink").bind("click", function() { //Capture link click
                $("#article").empty();
                selected = $(this).data("entryid");
                if (typeof selected !== "undefined") { //Check if everything is okay
                    selectedEntry = selected;
                }
                window.location = "#DisplayPage"; //View the content
            });

            $("#DisplayPage").bind("pagebeforeshow", function(prepage) {
                if ((feed == 'https://ci.openmrs.org/rss/createAllBuildsRssFeed.action?feedType=rssAll') && selectedEntry == 1)
                var title = (items[selectedEntry].getElementsByTagName("title")[0].childNodes[0].nodeValue); //get title name
                document.getElementById("titleText").innerHTML = title; //Set title
                content = items[selectedEntry].getElementsByTagName("description")[0].childNodes[0].nodeValue;

                $("#article").append(content); //Preload content

                $("a").click(function(event) {
                    event.preventDefault(); //Stop links from opening
                    href = this.href; //Get link from the link that was clicked
                    if ((href != "file:///android_asset/www/index.html#mainPage") && (href != "file:///android_asset/www/index.html#") && (href != "file:///android_asset/www/index.html#share") && (href != "file:///android_asset/www/index.html#Favorites") && (href != "file:///android_asset/www/index.html#About") && (href != "file:///android_asset/www/index.html#addFavorite") && (href != "file:///android_asset/www/index.html#addFavorite")) { //Make sure none of these links were clicked
                        window.plugins.childBrowser.showWebPage(href, { showLocationBar: true }); //Open the link in a childbrowser in order to prevent glitches as well as to make it easier to get back to using the app
                    }
                });
                $("#share").click(function() {
                    window.plugins.share.show({ //Let the user able to share the article easily
                        subject: 'Article on OpenMRS',
                        text: 'Here is a cool article I found on OpenMRS:\n'   + items[selectedEntry].getElementsByTagName("link")[0].childNodes[0].nodeValue},
                        function() {}, // Success function
                        function() {alert('Share failed')} // Failure function
                    );
                });
            });
        });

            function onDeviceReady() {
                navigator.splashscreen.hide();
            }
    });

</script>
</body>
</html>